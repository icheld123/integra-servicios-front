<div class="p-4 dashboard">

  <div class="bg-white m-auto border-2 border-gray-300 rounded-lg p-4 
              w-full max-w-7xl mb-6">

    <form [formGroup]="usuarioForm" class="flex items-center gap-3 w-full">

        <input
            type="search"
            placeholder="Correo del usuario"
            formControlName="usuario"
            class="w-full px-4 py-2 border rounded-lg shadow-sm 
                   focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        />

        <button
            type="button"
            (click)="buscarUsuario()"
            [disabled]="usuarioForm.invalid"
            class="px-4 py-2 rounded-lg text-white 
                   bg-red-600 disabled:bg-gray-400 disabled:cursor-not-allowed"
        >
            Buscar
        </button>

    </form>

    <!-- Usuario encontrado -->
    <div *ngIf="selectedUser" class="mt-4 bg-gray-100 p-4 rounded-lg">
      <p><strong>Nombre:</strong> {{selectedUser.usuario.nombre}}</p>
      <p><strong>Apellido:</strong> {{selectedUser.usuario.apellido}}</p>
      <p><strong>Correo:</strong> {{selectedUser.usuario.correo}}</p>
    </div>

  </div>

  <div class="bg-white m-auto border-2 border-gray-300 rounded-lg p-4 
              w-full max-w-7xl">

    <form [formGroup]="filter" class="flex flex-wrap items-center gap-4 w-full">

        <label class="flex gap-2 items-center">
          <input type="checkbox" formControlName="estado_1" />
          Reservada
        </label>

        <label class="flex gap-2 items-center">
          <input type="checkbox" formControlName="estado_2" />
          En préstamo
        </label>

        <label class="flex gap-2 items-center">
          <input type="checkbox" formControlName="estado_3" />
          Cancelada
        </label>

        <label class="flex gap-2 items-center">
          <input type="checkbox" formControlName="estado_4" />
          Completada
        </label>

        <button
            class="px-4 py-2 rounded-lg text-white 
                   bg-red-600 disabled:bg-gray-400 disabled:cursor-not-allowed"
            (click)="getReservas()"
            [disabled]="!selectedUser"
        >
            Buscar reservas
        </button>

    </form>
    <button
    type="button"
    (click)="reiniciarBusqueda()"
    class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600"
    >
    Reiniciar búsqueda
    </button>


  </div>

  <div class="mt-6 w-full m-auto">

    <!-- Si no hay resultados -->
    <div *ngIf="reservasPorUsuario.length==0" class="flex flex-col items-center justify-center gap-4 mt-8">
      <img src="assets/empty.svg" class="w-40" alt="">
      <p>¡Llena los campos requeridos para las reservas!</p>
    </div>

    <div *ngIf="reservasPorUsuario.length > 0">

        <div class="flex flex-wrap justify-center gap-4">

            <div *ngFor="let reserva of reservasPorUsuario"
                class="w-full sm:w-1/2 md:w-1/3 lg:w-1/4 bg-white border border-gray-300 
                            rounded-lg p-4 flex flex-col items-center">
                <p><strong>Identificador:</strong> {{reserva.recurso.id_recurso}}</p>
                <p><strong>Nombre:</strong> {{reserva.recurso.nombre_recurso}}</p>
                <p><strong>Desde:</strong> {{ reserva.fechas.fecha_inicio_transaccion | date:'yyyy-MM-dd HH:mm' }}</p>
                <p><strong>Hasta:</strong> {{ reserva.fechas.fecha_fin_transaccion | date:'yyyy-MM-dd HH:mm' }}</p>

                <button (click)="abrirModal(reserva)"
                    class="bg-red-300 hover:text-white text-black p-2 rounded-lg hover:bg-red-600 mt-4 shadow-md border border-red-400">
                    {{ reserva.estado_actual.id_estado_transaccion == 2 ? 'Devolver' : 'Prestar' }}
                </button>

            </div>

        </div>

        <div class="flex justify-center items-center mt-6 gap-4">

            <button (click)="prevPage()"
                    [disabled]="page === 1"
                    class="px-4 py-2 bg-gray-200 rounded-lg disabled:opacity-50">
            Anterior
            </button>

            <span class="text-gray-700 text-lg font-semibold">
            Página {{page}}
            </span>

            <button (click)="nextPage()"
                    class="px-4 py-2 bg-gray-200 rounded-lg">
            Siguiente
            </button>

        </div>

    </div>

  </div>
</div>
<app-confirmar-accion
    *ngIf="modalAbierto && !esDevolucion"
    [abierto]="modalAbierto"
    [reserva]="reservaSeleccionada"
    (cerrar)="cerrarModal()">
</app-confirmar-accion>
<app-devolucion-modal
    *ngIf="modalAbierto && esDevolucion"
    [abierto]="modalAbierto"
    [reserva]="reservaSeleccionada"
    (cerrar)="cerrarModal()">
</app-devolucion-modal>